<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>🌿 Serenity.ai — Your Mental Wellness Companion</title>
  <link rel="stylesheet" href="/static/style.css" />
  <style>
    #reset-btn {
      margin-top: 10px;
      background-color: #f44336;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    #reset-btn:hover {
      background-color: #d73833;
    }

    .spinner {
      color: #888;
      font-style: italic;
      margin-top: 5px;
    }

    footer {
      margin-top: 30px;
      text-align: center;
      font-size: 0.9em;
      color: #666;
    }

    footer a {
      color: #0077b5;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <h1>🌿 Welcome to Serenity.ai</h1>

    <div class="chat-box" id="chat-box">
      <div class="bot-message">Hello! I'm here to brighten your day 🌈 What’s on your mind?</div>
    </div>

    <div class="input-area">
      <input type="text" id="user-input" placeholder="Share your thoughts..." />
      <button onclick="sendMessage()">Send</button>
    </div>

    <button id="reset-btn">🔄 Reset Chat</button>

    <footer>
      👥 Visitors so far: <span id="visitor-count">0</span><br />
      Created by <a href="https://www.linkedin.com/in/vishal-rajaram-799b56245/" target="_blank">Vishal Rajaram</a>
    </footer>
  </div>

  <script>
    const chatBox = document.getElementById("chat-box");
    const resetBtn = document.getElementById("reset-btn");
    const visitorCountEl = document.getElementById("visitor-count");

    async function sendMessage() {
      const inputField = document.getElementById("user-input");
      const userText = inputField.value.trim();
      if (userText === "") return;

      chatBox.innerHTML += `<div class="user-message">${userText}</div>`;
      inputField.value = "";

      const spinner = document.createElement("div");
      spinner.className = "bot-message spinner";
      spinner.id = "loading-spinner";
      spinner.innerText = "⏳ Thinking...";
      chatBox.appendChild(spinner);
      chatBox.scrollTop = chatBox.scrollHeight;

      try {
        const response = await fetch("/get", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: userText }),
        });

        const data = await response.json();
        document.getElementById("loading-spinner").remove();
        chatBox.innerHTML += `<div class="bot-message">${data.response}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
      } catch (error) {
        document.getElementById("loading-spinner").remove();
        chatBox.innerHTML += `<div class="bot-message">Something went wrong. Please try again 💛</div>`;
      }
    }

    // Reset Chat + Increment Visitor Count
    resetBtn.addEventListener("click", async () => {
      chatBox.innerHTML = `<div class="bot-message">🧘 New conversation started. I'm here for you 🌿 What would you like to talk about?</div>`;
      try {
        const response = await fetch("/increment", { method: "POST" });
        const data = await response.json();
        visitorCountEl.textContent = data.count;
      } catch (err) {
        console.log("Error updating count:", err);
      }
    });

    // Load Visitor Count on Page Load
    async function loadVisitorCount() {
      try {
        const response = await fetch("/get-count");
        const data = await response.json();
        visitorCountEl.textContent = data.count;
      } catch (err) {
        console.log("Error loading count:", err);
      }
    }

    window.onload = loadVisitorCount;
  </script>
</body>
</html>
